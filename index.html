<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>UPPO GAME</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      margin-top: 60px;
    }
    input, button {
      font-size: 18px;
      padding: 10px;
      margin: 10px;
    }
    .screen {
      display: none;
    }
    .link-button {
      display: inline-block;
      background-color: #4CAF50;
      color: white;
      font-size: 20px;
      padding: 12px 24px;
      border-radius: 5px;
      text-decoration: none;
      margin-top: 20px;
      cursor: pointer;
    }
    .link-button:hover {
      background-color: #45a049;
    }
  </style>
</head>
<body>

  <!-- 1단계: 닉네임 입력 -->
  <div id="codeScreen" class="screen">
    <h1>업무포털 신학기 기념 모임에 오신걸 환영합니다.<br>
       닉네임을 입력하세요</h1>
    <input type="text" id="nicknameInput" placeholder="닉네임 입력">
    <br>
    <button onclick="submitNickname()">입장하기</button>
    <div id="codeError" style="color:red;"></div>
  </div>

  <!-- 2단계: 역할 확인 -->
  <div id="roleScreen" class="screen">
    <h1>당신의 정보</h1>
    <div id="roleResult" style="font-size:22px; margin:20px;"></div>
    <button onclick="goToVote()">투표하러 가기</button>
  </div>

  <!-- 3단계: 구글폼 투표 -->
  <div id="voteScreen" class="screen">
    <h1>투표를 진행하려면 아래 버튼을 클릭하세요</h1>
    <a class="link-button" href="https://docs.google.com/forms/d/e/1FAIpQLSdaFacNEOpuVPWfyrxA3iOkgQOyZD30tl7qNWT2AfylKkA4Sw/viewform?usp=header" target="_blank">
      구글폼으로 투표하기
    </a>
  </div>

  <script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyiqFeTc69boECIosGMG5oWivPDxGCwcELI92D7WGPGSCPIOlt7mVifyulWwxLr0roj/exec";

    function showScreen(id) {
      document.getElementById("codeScreen").style.display = "none";
      document.getElementById("roleScreen").style.display = "none";
      document.getElementById("voteScreen").style.display = "none";
      document.getElementById(id).style.display = "block";
    }

    function submitNickname() {
      const nickname = document.getElementById("nicknameInput").value.trim();
      const error = document.getElementById("codeError");

      if (!nickname) {
        error.textContent = "닉네임을 입력하세요.";
        return;
      }

      fetch(SCRIPT_URL, {
        method: "POST",
        body: JSON.stringify({ nickname: nickname }),
        headers: { "Content-Type": "application/json" }
      })
      .then(res => res.json())
      .then(data => {
        if (data.status === "duplicate") {
          error.textContent = "이미 사용된 닉네임입니다.";
        } else {
          document.getElementById("roleResult").innerHTML =
            `닉네임: ${nickname}<br>
             순서: ${data.order}번<br>
             상태: ${data.role}`;
          showScreen("roleScreen");
        }
      })
      .catch(() => {
        error.textContent = "서버 연결 오류";
      });
    }

    function goToVote() {
      showScreen("voteScreen");
    }

    window.onload = () => {
      showScreen("codeScreen");
    };
  </script>

</body>
</html>
